<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>IndexAlias.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">neureka</a> &gt; <a href="index.source.html" class="el_package">neureka.framing</a> &gt; <span class="el_source">IndexAlias.java</span></div><h1>IndexAlias.java</h1><pre class="source lang-java linenums">package neureka.framing;

import neureka.Component;
import neureka.Tsr;
import java.util.*;
import java.util.function.Function;

public class IndexAlias implements Component&lt;Tsr&gt;
{

    private Map&lt;Object, Object&gt; _mapping;

<span class="fc" id="L13">    public IndexAlias(List&lt;List&lt;Object&gt;&gt; labels){</span>
<span class="fc" id="L14">        _mapping = new LinkedHashMap&lt;&gt;(labels.size());</span>
<span class="fc bfc" id="L15" title="All 2 branches covered.">        for(int i=0; i&lt;labels.size(); i++) _mapping.put(i, new LinkedHashMap&lt;&gt;());</span>
<span class="fc bfc" id="L16" title="All 2 branches covered.">        for(int i=0; i&lt;labels.size(); i++){</span>
<span class="pc bpc" id="L17" title="1 of 2 branches missed.">            if(labels.get(i)!=null){</span>
<span class="fc bfc" id="L18" title="All 2 branches covered.">                for(int ii=0; ii&lt;labels.get(i).size(); ii++){</span>
<span class="pc bpc" id="L19" title="1 of 2 branches missed.">                    if(labels.get(i).get(ii)!=null) set(i, labels.get(i).get(ii), ii);</span>
                }
            }
        }
<span class="fc" id="L23">    }</span>

<span class="nc" id="L25">    public IndexAlias(int size) {</span>
<span class="nc" id="L26">        _mapping = new LinkedHashMap&lt;&gt;(size);</span>
<span class="nc bnc" id="L27" title="All 2 branches missed.">        for(int i=0; i&lt;size; i++) _mapping.put(i, new LinkedHashMap&lt;&gt;());</span>
<span class="nc" id="L28">    }</span>

<span class="fc" id="L30">    public IndexAlias(Map&lt;Object, List&lt;Object&gt;&gt; labels, Tsr host){</span>
<span class="fc" id="L31">        _mapping = new LinkedHashMap&lt;&gt;(labels.size()*3);</span>
<span class="fc" id="L32">        int[] index = {0};</span>
<span class="fc" id="L33">        labels.forEach((k, v)-&gt;{</span>
<span class="fc bfc" id="L34" title="All 2 branches covered.">            if(v!=null){</span>
<span class="fc" id="L35">                Map&lt;Object, Integer&gt; idxmap = new LinkedHashMap&lt;&gt;(v.size()*3);</span>
<span class="fc bfc" id="L36" title="All 2 branches covered.">                for(int i=0; i&lt;v.size(); i++) idxmap.put(v.get(i), i);</span>
<span class="fc" id="L37">                _mapping.put(k, idxmap);</span>
<span class="fc" id="L38">            } else {</span>
<span class="fc" id="L39">                _mapping.put(k, host.shape()[index[0]]);</span>
            }
<span class="fc" id="L41">            index[0]++;</span>
<span class="fc" id="L42">        });</span>
<span class="fc" id="L43">    }</span>

    public int[] get(List&lt;Object&gt; keys){
<span class="nc" id="L46">        return get(keys.toArray(new Object[keys.size()]));</span>
    }

    public int[] get(Object[] keys){//Todo: iterate over _mapping
<span class="nc" id="L50">        int[] idx = new int[keys.length];//_mapping.length];</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">        for(int i=0; i&lt;idx.length; i++){</span>
<span class="nc" id="L52">            Object am =  _mapping.get(i);</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">            if(am instanceof Map){</span>
<span class="nc" id="L54">                idx[i] = ((Map&lt;Object, Integer&gt;)am).get(keys[i]);</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">            } else if (am instanceof Integer){</span>

            }
            //idx[i] = _mapping.get(i).get(keys[i]);

        }
<span class="nc" id="L61">        return idx;</span>
    }

    public int get(Object key, Object axis)
    {
<span class="fc" id="L66">        Object am =  _mapping.get(axis);</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">        if(am instanceof Map) return ((Map&lt;Object, Integer&gt;)am).get(key);</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">        return (key instanceof Integer)?((Integer)key):0;</span>
    }

    public void replace(Object axis, Object indexKey, Object newIndexKey)
    {
<span class="fc" id="L73">        Object am =  _mapping.get(axis);</span>
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">        if(am instanceof Map) ((Map&lt;Object, Integer&gt;)am).put(newIndexKey, ((Map&lt;Object, Integer&gt;)am).remove(indexKey));</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">        else if (am instanceof Integer) _initializeIdxmap(axis, (Integer)am, newIndexKey, (Integer)indexKey);</span>
<span class="fc" id="L76">    }</span>

    private void _initializeIdxmap(Object axis, int size, Object key, int index){
<span class="fc" id="L79">        Map newIdxmap = new LinkedHashMap&lt;&gt;(size*3);</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">        for(int i=0; i&lt;size; i++) {</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">            if(index==i) newIdxmap.put(key, i);</span>
<span class="fc" id="L82">            else newIdxmap.put(i, i);</span>
        }
<span class="fc" id="L84">        _mapping.put(axis, newIdxmap);</span>
<span class="fc" id="L85">    }</span>

    public void set(Object axis, Object indexKey, int index)
    {
<span class="fc" id="L89">        Object am =  _mapping.get(axis);</span>
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">        if(am instanceof Map) ((Map&lt;Object, Integer&gt;)am).put(indexKey, index);</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">        else if (am instanceof Integer) _initializeIdxmap(axis, (Integer)am, indexKey, index);</span>
<span class="fc" id="L92">    }</span>

    public List&lt;Object&gt; keysOf(Object axis)
    {
<span class="fc" id="L96">        List&lt;Object&gt; keys = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L97">        Object am =  _mapping.get(axis);</span>
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">        if(am instanceof Map) ((Map&lt;Object, Integer&gt;)am).forEach((k, v)-&gt;keys.add(k));</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">        else for(int i=0; i&lt;((Integer)am); i++) keys.add(i);</span>
<span class="fc" id="L100">        return keys;</span>
    }

    public List&lt;Object&gt; keysOf(Object axis, int index){
<span class="fc" id="L104">        List&lt;Object&gt; keys = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L105">        Object am =  _mapping.get(axis);</span>
<span class="pc bpc" id="L106" title="1 of 4 branches missed.">        if(am instanceof Map) ((Map&lt;Object, Integer&gt;)am).forEach((k, v)-&gt;{if(v==index) keys.add(k);});</span>
<span class="nc" id="L107">        else keys.add(index);</span>
<span class="fc" id="L108">        return keys;</span>
    }

    private String _fixed(String str, int size){
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">        if(str.length()&lt;size){</span>
<span class="fc" id="L113">            int first = size/2;</span>
<span class="fc" id="L114">            int second = size - first;</span>
<span class="fc" id="L115">            first -= str.length()/2;</span>
<span class="fc" id="L116">            second -= str.length()-str.length()/2;</span>
<span class="fc bfc" id="L117" title="All 2 branches covered.">            for (int i=0; i&lt;first; i++) str = &quot; &quot;+str;</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">            for (int i=0; i&lt;second; i++) str += &quot; &quot;;</span>
        }
<span class="fc" id="L120">        return str;</span>
    }


    @Override
    public String toString(){
<span class="fc" id="L126">        final int WIDTH = 16;</span>
<span class="fc" id="L127">        final String WALL = &quot; | &quot;;</span>
<span class="fc" id="L128">        final String HEADLINE = &quot;=&quot;;</span>
<span class="fc" id="L129">        final String ROWLINE = &quot;-&quot;;</span>
<span class="fc" id="L130">        final String CROSS = &quot;+&quot;;</span>

<span class="fc" id="L132">        int indexShift = (WALL.length()/2);</span>
<span class="fc" id="L133">        int crossMod = WIDTH+WALL.length();</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">        Function&lt;Integer, Boolean&gt; isCross = (i)-&gt;(i-indexShift)%crossMod==0;</span>
<span class="fc" id="L135">        StringBuilder builder = new StringBuilder();</span>
<span class="fc" id="L136">        builder.append(WALL);</span>

<span class="fc" id="L138">        int[] axisLabelSizes = new int[_mapping.size()];</span>
<span class="fc" id="L139">        int[] axisCounter = {0};</span>
<span class="fc" id="L140">        _mapping.forEach((k, v)-&gt;{</span>
<span class="fc" id="L141">            String axisHeader = k.toString();</span>
<span class="fc" id="L142">            axisHeader = _fixed(axisHeader, WIDTH);</span>
<span class="fc" id="L143">            axisLabelSizes[axisCounter[0]] = axisHeader.length();</span>
<span class="fc" id="L144">            builder.append(axisHeader);</span>
<span class="fc" id="L145">            builder.append(WALL);</span>
<span class="fc" id="L146">            axisCounter[0]++;</span>
<span class="fc" id="L147">        });</span>
<span class="fc" id="L148">        int lineLength = builder.length();</span>
<span class="fc" id="L149">        builder.append(&quot;\n&quot;);</span>
<span class="fc bfc" id="L150" title="All 4 branches covered.">        for(int i=0; i&lt;lineLength; i++) builder.append((isCross.apply(i))?CROSS:HEADLINE);</span>
<span class="fc" id="L151">        builder.append(&quot;\n&quot;);</span>
<span class="fc" id="L152">        boolean[] hasMoreIndexes = {true};</span>
<span class="fc" id="L153">        int[] depth = {0};</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">        while (hasMoreIndexes[0]){</span>
<span class="fc" id="L155">            axisCounter[0] = 0;</span>
<span class="fc" id="L156">            Object[] keyOfDepth = {null};</span>
<span class="fc" id="L157">            builder.append(WALL);</span>
<span class="fc" id="L158">            _mapping.forEach((k, v)-&gt;{</span>
<span class="fc" id="L159">                keyOfDepth[0] = null;</span>
<span class="fc bfc" id="L160" title="All 2 branches covered.">                if(v instanceof Map){</span>
<span class="fc" id="L161">                    ((Map&lt;Object, Integer&gt;)v).forEach((ik, iv)-&gt;{</span>
<span class="fc bfc" id="L162" title="All 2 branches covered.">                        if(iv.intValue()==depth[0]) keyOfDepth[0] = ik;</span>
<span class="fc" id="L163">                    });</span>
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">                } else if(v instanceof Integer){</span>
<span class="pc bpc" id="L165" title="1 of 2 branches missed.">                    if(depth[0]&lt;((Integer)v)) keyOfDepth[0] = depth[0];</span>
                }
<span class="fc bfc" id="L167" title="All 2 branches covered.">                if(keyOfDepth[0]!=null){</span>
<span class="fc" id="L168">                    builder.append(_fixed((keyOfDepth[0]).toString(), WIDTH));</span>
                } else {
<span class="fc" id="L170">                    builder.append(_fixed(&quot;---&quot;, WIDTH));</span>
                }
<span class="fc" id="L172">                builder.append(WALL);</span>
<span class="fc" id="L173">                axisCounter[0] ++;</span>
<span class="fc" id="L174">            });</span>
<span class="fc" id="L175">            depth[0]++;</span>
<span class="fc" id="L176">            builder.append(&quot;\n&quot;);</span>
<span class="fc bfc" id="L177" title="All 4 branches covered.">            for(int i=0; i&lt;lineLength; i++) builder.append((isCross.apply(i))?CROSS:ROWLINE);</span>
<span class="fc" id="L178">            builder.append(&quot;\n&quot;);</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">            if(keyOfDepth[0]==null) hasMoreIndexes[0] = false;</span>
<span class="fc" id="L180">        }</span>

<span class="fc" id="L182">        StringBuilder result = new StringBuilder().append(&quot;\nTensor IndexAlias: axis/indexes&quot;);</span>
<span class="fc" id="L183">        result.append(&quot;\n&quot;);</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">        for(int i=0; i&lt;lineLength; i++) result.append(HEADLINE);</span>
<span class="fc" id="L185">        result.append(&quot;\n&quot;);</span>

<span class="fc" id="L187">        result.append(builder);</span>
<span class="fc" id="L188">        return result.toString();</span>
    }


    @Override
    public void update(Tsr oldOwner, Tsr newOwner) {
        
<span class="nc" id="L195">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>